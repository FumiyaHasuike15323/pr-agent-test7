# .github/workflows/changelog-staging.yml

name: Auto Update Changelog (Staging to Master)

on:
  pull_request:
    types: [closed] # PRãŒã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œ
    branches:
      - master # masterãƒ–ãƒ©ãƒ³ãƒã¸ã®PRã®ã¿å¯¾è±¡

jobs:
  update_changelog:
    # stagingãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰masterãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸPRã®ã¿ã‚’å¯¾è±¡
    if: github.event.pull_request.merged == true && github.event.pull_request.head.ref == 'staging'
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      issues: write
      contents: write # CHANGELOG.mdãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ã«å¿…è¦
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Run PR Agent Update Changelog
        uses: Codium-ai/pr-agent@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_KEY: ${{ secrets.OPENAI_KEY }}
          # changelogãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›´ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹
          PR_UPDATE_CHANGELOG__PUSH_CHANGELOG_CHANGES: "true"
          # CIå®Ÿè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ï¼ˆchangelogã‚³ãƒŸãƒƒãƒˆã§CIãŒå†å®Ÿè¡Œã•ã‚Œã‚‹ã®ã‚’é˜²ãï¼‰
          PR_UPDATE_CHANGELOG__SKIP_CI_ON_PUSH: "true"
          # PRãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã™ã‚‹
          PR_UPDATE_CHANGELOG__ADD_PR_LINK: "true"
          # æ—¥æœ¬èªã§ã®changelogç”ŸæˆæŒ‡ç¤º
          PR_UPDATE_CHANGELOG__EXTRA_INSTRUCTIONS: |
            ã“ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å¤‰æ›´å†…å®¹ã‚’ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«åˆ†ã‹ã‚Šã‚„ã™ãæ—¥æœ¬èªã§ç°¡æ½”ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚ãƒªãƒªãƒ¼ã‚¹ã®å ±å‘Šæ–‡ç« ã«ä½¿ã„ãŸã„ã§ã™ã€‚
            ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦ãã ã•ã„ï¼š
            - âœ¨ æ©Ÿèƒ½: æ–°æ©Ÿèƒ½ã®è¿½åŠ 
            - ğŸ› ä¿®æ­£: ãƒã‚°ä¿®æ­£
            - ğŸ”§ æ”¹å–„: æ—¢å­˜æ©Ÿèƒ½ã®æ”¹å–„
            - ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
            - ğŸ¨ ã‚¹ã‚¿ã‚¤ãƒ«: ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã®å¤‰æ›´
          # changelogã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
          GITHUB_ACTION.AUTO_UPDATE_CHANGELOG: "true"
